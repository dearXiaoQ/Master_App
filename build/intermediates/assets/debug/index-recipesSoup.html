<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>recipesSoup</title>
    <!--<link rel="stylesheet" href="styles/ionic.min.css"/>-->
    <link href="styles/bootstrap.min.css" rel="stylesheet">
    <link href="styles/flat-ui.min.css" rel="stylesheet">
    <!--<link href="styles/font-awesome.min.css" rel="stylesheet">-->
    <script src="scripts/libs/jquery-2.0.3.min.js"></script>
    <!--<script src="scripts/libs/flat-ui.min.js"></script>-->
    <script src="scripts/libs/iSlider.js"></script>


    <style type="text/css">
        .card {
            padding-top: 1px;
            padding-bottom: 1px;
            padding-left: 10px;
            padding-right: 30px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, .3);
            overflow: hidden;
            margin: 5%;
            border-radius: 2px;
            background-color: #fff;
            text-align: center;
        }

        .card img {
            margin-top: 20px;
            margin-bottom: 50px;
        }

        .card p {
            font-size: 1.4em;
        }

        body {
            background: rgb(245, 245, 245);

        }
    </style>
</head>

<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-1 ">
        </div>

        <div class="col-md-10">
            <div class="wrap " id="wrap">
                <div class="item ">
                    <div class="card">
                        <h3>
                            Stewed pear with white fungus and sweet-scented osmanthus
                        </h3>

                        <div class="row">
                            <div class="col-md-8">
                                <img alt="Bootstrap Image Preview" width="90%" height="70%" src="images/xr1.jpg"/>
                            </div>
                            <div class="col-md-4" style="text-align: left ;padding-top: 20px">
                                <p style="font-size: 1.4em">
                                    <strong class="text-info">Difficulty：</strong> beginner
                                </p>

                                <p style="font-size: 1.4em">
                                    <strong class="text-info">Time：</strong>50~60 min
                                </p>

                                <p style="font-size: 1.4em">
                                    <strong class="text-info">Ingredients：</strong>a pear  &nbsp;&nbsp; a white fungus 
                                    &nbsp;&nbsp;8g medlar  &nbsp;&nbsp; 3g sweet-scented osmanthus
                                </p>

                                <p style="font-size: 1.4em">
                                    <strong class="text-info">Seasonings ：</strong>20g rock candy  &nbsp;&nbsp;appropriate amount honey
                                </p>
                            </div>
                        </div>
                        <br/>
                    </div>

                </div>
                <div class="item ">
                    <div class="card">
                        <h3>
                            Preparation
                        </h3>

                        <div class="row">
                            <div class="col-md-8">
                                <img alt="Bootstrap Image Preview" width="90%" height="70%" src="images/xr2.jpg"/>
                            </div>
                            <div class="col-md-4" style="text-align: left">
                                <h3 class="text-info">Step 1</h3>
                                <h4>Prepare raw materials</h4>

                                <p>a pear &nbsp;&nbsp; a white fungus &nbsp;&nbsp;
                                    8g medlar &nbsp;&nbsp; 3g sweet-scented osmanthus &nbsp;&nbsp;
                                    20g rock candy &nbsp;&nbsp; appropriate amount honey 
                                </p>

                            </div>
                        </div>
                        <br/>
                    </div>
                </div>
                <div class="item ">
                    <div class="card">
                        <h3>
                            Preparation
                        </h3>

                        <div class="row">
                            <div class="col-md-8">
                                <img alt="Bootstrap Image Preview" width="90%" height="70%" src="images/xr3.jpg"/>
                            </div>
                            <div class="col-md-4" style="text-align: left">
                                <h3 class="text-info">Step 2</h3>
                                <h4>Treatment of raw materials</h4>

                                <p>Peel the pears and remove the cores.Cut the pear into pieces. </p>
                            </div>
                        </div>
                        <br/>
                    </div>
                </div>
                <div class="item ">
                    <div class="card">
                        <h3>
                            Preparation
                        </h3>

                        <div class="row">
                            <div class="col-md-8">
                                <img alt="Bootstrap Image Preview" width="90%" height="70%" src="images/xr4.jpg"/>
                            </div>
                            <div class="col-md-4" style="text-align: left">
                                <h3 class="text-danger">Step 3</h3>
                                <h4>Treatment of raw materials</h4>

                                <p>White fungus remove root,wash,tear into small pieces.</p>

                                <div class="card" style="text-align: left;margin: 0;padding: 20px">
                                    <button type="button" class="btn btn-info  btn-block" onclick="buttonClick()">
                                        Start intelligent cooking
                                    </button>
                                </div>
                            </div>
                        </div>
                        <br/>
                    </div>
                </div>
                <div class="item ">
                    <div class="card">
                        <h3>
                            Cooking process
                        </h3>

                        <div class="row">
                            <div class="col-md-8">
                                <img alt="Bootstrap Image Preview" width="90%" height="70%" src="images/xr5.jpg"/>
                            </div>
                            <div class="col-md-4" style="text-align: left">
                                <h3 class="text-danger">Step 4</h3>

                                <p>Add all ingredients to the pot and fill with water, boil for<strong>3min</strong></p>

                                <div class="card" style="text-align: left;margin: 0;padding: 20px">
                                    <p>
                                        <strong class="text-info">Temperature&nbsp;&nbsp;&nbsp;&nbsp;</strong><span
                                            class="text-danger" id="temp1"></span>
                                        &nbsp;&nbsp;&nbsp;<span class="text-warning">℃</span>
                                    </p>

                                    <p>
                                        <strong class="text-info">Power&nbsp;&nbsp;&nbsp;&nbsp;</strong><span
                                            class="text-danger" id="power1"></span>
                                        &nbsp;&nbsp;&nbsp;<span class="text-warning">W</span>
                                    </p>
                                    <button type="button" class="btn btn-warning  btn-block" onclick="buttonClick()">
                                        Stop intelligent cooking
                                    </button>
                                </div>
                            </div>
                        </div>
                        <br/>
                    </div>
                </div>
                <div class="item ">
                    <div class="card">
                        <h3>
                            Cooking process
                        </h3>

                        <div class="row">
                            <div class="col-md-8">
                                <img alt="Bootstrap Image Preview" width="90%" height="70%" src="images/xr6.jpg"/>
                            </div>
                            <div class="col-md-4" style="text-align: left">
                                <h3 class="text-danger">Step 5</h3>

                                <p> Turn to medium heat <strong>30 min</strong></p>

                                <div class="card" style="text-align: left;margin: 0;padding: 20px">
                                    <p>
                                        <strong class="text-info">Temperature&nbsp;&nbsp;&nbsp;&nbsp;</strong><span
                                            class="text-danger" id="temp2"></span>
                                        &nbsp;&nbsp;&nbsp;<span class="text-warning">℃</span>
                                    </p>

                                    <p>
                                        <strong class="text-info">Power&nbsp;&nbsp;&nbsp;&nbsp;</strong><span
                                            class="text-danger" id="power2"></span>
                                        &nbsp;&nbsp;&nbsp;<span class="text-warning">W</span>
                                    </p>
                                    <button type="button" class="btn btn-warning  btn-block" onclick="buttonClick()">
                                        Stop intelligent cooking
                                    </button>
                                </div>
                            </div>
                        </div>
                        <br/>
                    </div>
                </div>
                <div class="item ">
                    <div class="card">
                        <h3>
                            Cooking process
                        </h3>

                        <div class="row">
                            <div class="col-md-8">
                                <img alt="Bootstrap Image Preview" width="90%" height="70%" src="images/xr7.jpg"/>
                            </div>
                            <div class="col-md-4" style="text-align: left">
                                <h3 class="text-danger">Step 6</h3>

                                <p>Pour into the bowl and sprinkle with sweet-scented osmanthus.Remain warm,covered with honey and enjoy.</p>
                            </div>
                        </div>
                        <br/>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-1">
        </div>
    </div>
</div>
<div class="play" id="loading"></div>
<script>

    var autoPlayFlag = false;
    var curIndex = 0;
    var myslider = {};
    window.onload = function () {
        setTimeout(function () {
            myslider = new iSlider({
                wrap: '#wrap',
                item: '.item',
                noslide: [3, 4, 5, 6],
                noslideBack: true,
                speed: 600,
                onslide: function (index) {
                    curIndex = index-3;
                    console.info('now index : ' + index);

                }
            });
            console.log('time OUT ONLOAD 500');
        }, 500);

    }

    var intervalHandle = undefined;
    function autoPlay() {
        autoPlayFlag = true;
        myslider.slideTo(4);
        curStep = 0;//开始烹饪
        if (intervalHandle == undefined) {

            intervalHandle = setInterval(function () {
//            console.log('here');
                cooking();
            }, 1000);
        }

    }
    function stopCook() {
        autoPlayFlag = false;
        timeCountDownStarted = false;
        curMenuTimeOut = 0;
        curStep = -1;
        //RecipeObject.sendPower(0, false);
//        dataConvert(0);
        setPower(0);
    }


    function buttonClick() {
        if (autoPlayFlag == false) {
            autoPlay();
            $('button').text('Pause intelligent cooking');
        } else {
            $('button').text('Start intelligent cooking');
            stopCook();
        }
    }

    var menuStepArr = [//烹饪步骤
        //原理：温度优先原则，在没有达到设定温度前大火力加温，达到温度后开始计时，在计时范围内保持温度，
        {//第一步
            'temp': 53,//C
            'time': 60,//S
            'power': 1800//w
        },
        {//第二步
            'temp': 40,//C
            'time': 60,//S
            'power': 1000//w
        }
    ];


    var bug = function (msg) {
        console.log('Beef:' + msg);
    };


    var tempDataStore = 1;
    function getTempData(temp) {
        var byteArr = temp.split(',');
        var x = new Int16Array(1);

        if (byteArr.length === 2) {
            var Int16TmpStr = byteArr[0] + byteArr[1];
            x[0] = parseInt(Int16TmpStr, 16);
            console.log('Int16  = ' + x[0]);
            tempDataStore = x[0];
//            numRun.resetData(x[0]);
//            document.getElementById('temp').innerHTML = ' '+x[0];
        }
    }
    function getIndData(temp) {
        var byteArr = temp.split(',');
        var x = new Uint16Array(1);

        console.log('IndCooker data : ' + temp);
        if (byteArr.length === 3) {
            var powerSw = byteArr[0];
            var Int16TmpStr = byteArr[2] + byteArr[1];
            x[0] = parseInt(Int16TmpStr, 16);
            console.log('Int16  = ' + x[0]);
            var str = ' ';
            if (powerSw == '55') {
                str = '电磁炉开 ';
                x[0] = x[0] * 300 + 300;
            } else if (powerSw == 'aa') {
                str = '电磁炉关 ';
                x[0] = 0;
            }

            var idStr='power1';
            for(var i=1;i<3;i++){
                idStr='power'+i;
                document.getElementById(idStr).innerHTML = ' ' + x[0];
            }
        }
    }
    var getTemp = function () {
        bug('in getTemp');

        var temp = tempDataStore; // RecipeObject.getTempData();
        bug(temp);
        if(temp>30){
            //temp=102.95*Math.log(temp)-285.72;
            temp = -0.0193*Math.pow(temp,2)+3.1562*temp-28.332;
        }


        if(curIndex<=2&&curIndex>0){
            var tmp = 'temp'+curIndex;
            document.getElementById(tmp).innerHTML = ' '+curTemp;
        }
        return parseInt(Number(temp));
    };

    function setData(data) {
        console.log('setData :' + data);
        RecipeObject.setIndData(data);
    }

    function dataConvert(input) {

        var sendBuf = [];
        if (input > 0) {
            var int16Buf = new Uint16Array(1);
            int16Buf[0] = (input - 300) / 300;

            var U8input = new Uint8Array(int16Buf.buffer);
            sendBuf[0] = 85;
            sendBuf[1] = U8input[0];
            sendBuf[2] = U8input[1];

            console.log('btnClick on = ' + int16Buf[0]);
            console.log('btnClick buf = ' + sendBuf);


        } else {
            sendBuf[0] = 170;
            sendBuf[1] = 0;
            sendBuf[2] = 0;

        }
        setData(sendBuf);
    }

    var curTemp = 0;
    var curPower = 0;
    var setPower = function (power) {
        console.log('setPower : ' + power);

        curPower = power;
        if(curIndex<=2&&curIndex>0){
            var tmp = 'power'+curIndex;
            document.getElementById(tmp).innerHTML = ' '+curPower;
        }
        dataConvert(power);

    };
    var curStep = 0;
    var curMenu = {};
    var timeCountDownStarted = false;
    var curMenuTimeOut = 0;
    var cooking = function () {

        bug('cooking');
        if (curStep == -1) {
            <!--stopCook();-->
            return;
        }

        curMenu = menuStepArr[curStep];
        bug('bef getTemp');
        var temp = getTemp();
        curTemp = temp;
        if(curTemp<0){
            curTemp=0;
        }
        bug('af getTemp');
        if (temp >= curMenu.temp) {
            //TODO:开始计时
            if (timeCountDownStarted == false) {
                timeCountDownStarted = true;
                curMenuTimeOut = curMenu.time;
            }
            //TODO:使用设定火力
            if (temp == curMenu.temp) {
                setPower(curMenu.power);
            } else if (temp - 2 > curMenu.temp) {
                setPower(0);
            } else {
                setPower(900);
            }

        } else if (temp < curMenu.temp - 2) {
            setPower(2100);
        }

        if (timeCountDownStarted) {
            curMenuTimeOut--;
            if (curMenuTimeOut == 0) {
                timeCountDownStarted = false;
                curStep++;
                if (curStep >= menuStepArr.length) {
                    curStep = -1;
                    stopCook();
                    myslider.slideTo(0);
                } else {
                    myslider.next();
                }
            }
        }
    };

</script>
</body>
</html>